use QLDUAN
go

CREATE TABLE PHONGBAN
(
MaPB INT constraint PB_MaPB_PK PRIMARY KEY,
TenPB VARCHAR (10) constraint PB_TenPB_UQ UNIQUE,
TrPhong CHAR(9),
NgNhanChuc DATETIME default (GetDate())
)

CREATE TABLE NHANVIEN
(
MaNV CHAR(9) constraint NV_MaNV_PK PRIMARY KEY,
Ho VARCHAR(15) NOT NULL,
TenDem VARCHAR (15),
Ten VARCHAR(15) NOT NULL,
NgSinh DATETIME,
DiaChi VARCHAR(50),
GTinh CHAR(3) constraint NV_GTinh_CK CHECK (GTinh IN ('Nam', 'Nu')),
Luong INT,
MaGSat CHAR(9) constraint NV_MaGSat_FK FOREIGN KEY (MaGSat) REFERENCES
NHANVIEN(MaNV),
Phong INT constraint NV_Phong_FK FOREIGN KEY (Phong) REFERENCES
PHONGBAN(MaPB)
)

CREATE TABLE DUAN
(
MaDA INT constraint DUAN_MaDA_PK PRIMARY KEY,
TenDA VARCHAR(15) NOT NULL,
DiaDiem VARCHAR(15),
PhongQL INT constraint DUAN_PHONGQL_FK FOREIGN KEY (PhongQL) REFERENCES
PHONGBAN(MaPB)
)

CREATE TABLE PHANCONG
(
MaNV CHAR(9) NOT NULL,
MaDA INT NOT NULL,
SoGio DECIMAL (3,1),
constraint PC_MaNV_MaDA_PK PRIMARY KEY (MaNV, MaDA),
constraint PC_MaNV_FK FOREIGN KEY (MaNV) REFERENCES NHANVIEN(MaNV),
constraint PC_MaDA_FK FOREIGN KEY (MaDA) REFERENCES DUAN(MaDA)
)

CREATE TABLE THANNHAN
(
MaNV CHAR (9) NOT NULL,
TenTN CHAR(15) NOT NULL,
GTinh CHAR (3) constraint TN_GTinh_CK CHECK (GTinh IN ('Nam', 'Nu')),
NgSinh DATETIME,
QuanHe VARCHAR (10),
constraint TN_MaNV_TenTN_PK PRIMARY KEY (MaNV, TenTN),
constraint TN_MaNV_FK FOREIGN KEY (MaNV) REFERENCES NHANVIEN (MaNV)
)

CREATE TABLE DIADIEM_PHONG
(
MaPB INT NOT NULL,
DiaDiem VARCHAR(15) NOT NULL,
constraint DD_P_MaPB_DiaDiem_PK PRIMARY KEY(MaPB, DiaDiem),
constraint DD_P_MaPB_PK FOREIGN KEY (MaPB) REFERENCES PHONGBAN(MaPB)
)

ALTER TABLE PHONGBAN
ADD CONSTRAINT PB_TrPhong_FK FOREIGN KEY (TrPhong) REFERENCES NHANVIEN(MaNV)

ALTER TABLE PHONGBAN ADD NamTL INT

ALTER TABLE PHONGBAN
ALTER COLUMN NamTL SMALLINT

ALTER TABLE PHONGBAN
ADD CONSTRAINT PB_NamTL_CK CHECK(NamTL >=1990)

ALTER TABLE PHONGBAN
DROP PB_NamTL_CK

ALTER TABLE PHONGBAN
DROP COLUMN NamTL

ALTER TABLE PHONGBAN
ALTER COLUMN TenPB VARCHAR(15);

INSERT INTO PHONGBAN (MaPB,TenPB, TrPhong, NgNhanChuc) VALUES('5','Nghiencuu',NULL,'06/22/1988')
INSERT INTO PHONGBAN (MaPB,TenPB, TrPhong, NgNhanChuc) VALUES('4','Hanhchinh',NULL,'01/01/1995')
INSERT INTO PHONGBAN (MaPB,TenPB, TrPhong, NgNhanChuc) VALUES('1','Giamdoc',NULL,'06/19/1981')

INSERT INTO NHANVIEN 
VALUES('888665555', 'Le','Van','Bo', '11/10/1937','45 Ho Van Hue, Phu Nhuan, TPHCM',
'Nam',
55000,NULL,1 )

INSERT INTO NHANVIEN
VALUES('333445555', 'Phan','Van','Nghia', '12/08/1955','63 Tran Huy Lieu, Phu Nhuan,
TPHCM',
'Nam', 40000,'888665555',5 )

INSERT INTO NHANVIEN
VALUES('123456789', 'Nguyen','Bao','Hung', '01/09/1965','73 Phan Dang Luu, Phu Nhuan,
TPHCM',
'Nam', 30000,'333445555',5 )

INSERT INTO NHANVIEN
VALUES('666884444', 'Tran','Van','Nam', '09/15/1962','97 Dien Bien Phu, Binh Thanh,
TPHCM',
'Nam', 38000,'333445555',5 )

INSERT INTO NHANVIEN
VALUES('453453453', 'Hoang','Kim','Yen', '07/31/1972','56 Thich Quang Duc, Phu Nhuan,
TPHCM',
'Nu', 25000,'333445555',5 )

INSERT INTO NHANVIEN
VALUES('987654321', 'Du','Thi','Hau', '06/20/1941','29 Bach Dang, Tan Binh, TPHCM',
'Nu',
43000,'888665555',4 )
INSERT INTO NHANVIEN
VALUES('999887777', 'Au','Thi','Vuong', '01/19/1968','32 Cao Ba Nha, Q1, TPHCM', 'Nu',
25000,'987654321',4 )
INSERT INTO NHANVIEN
VALUES('987987987', 'Nguyen','Van','Giap', '03/29/1969','98 Huynh Van Banh, Phu Nhuan,
TPHCM', 'Nam', 25000,'987654321',4 )

INSERT INTO DIADIEM_PHONG VALUES(1, 'Phu Nhuan')
INSERT INTO DIADIEM_PHONG VALUES(4, 'Go Vap')
INSERT INTO DIADIEM_PHONG VALUES(5, 'Tan Binh')
INSERT INTO DIADIEM_PHONG VALUES(5, 'Phu Nhuan')
INSERT INTO DIADIEM_PHONG VALUES(5, 'Thu Duc')

INSERT INTO DUAN
VALUES(1,'San pham X', 'Tan Binh', 5)
INSERT INTO DUAN
VALUES(2,'San pham y', 'Thu Duc', 5)
INSERT INTO DUAN
VALUES(3,'San pham Z', 'Phu Nhuan', 5)
INSERT INTO DUAN
VALUES(10,'Tin hoc hoa', 'Go Vap', 4)
INSERT INTO DUAN
VALUES(20,'Tai to chuc', 'Phu Nhuan', 1)
INSERT INTO DUAN
VALUES(30,'Phuc Loi', 'Go Vap', 4)

INSERT INTO PHANCONG VALUES('123456789',2,7.5)
INSERT INTO PHANCONG VALUES('666884444',3,40.0)
INSERT INTO PHANCONG VALUES('453453453',1,20.0)
INSERT INTO PHANCONG VALUES('453453453',2,20.0)
INSERT INTO PHANCONG VALUES('333445555',2,10.0)
INSERT INTO PHANCONG VALUES('333445555',3,10.0)
INSERT INTO PHANCONG VALUES('333445555',10,10.0)
INSERT INTO PHANCONG VALUES('333445555',20,10.0)
INSERT INTO PHANCONG VALUES('999887777',30,30.0)
INSERT INTO PHANCONG VALUES('999887777',10,10.0)
INSERT INTO PHANCONG VALUES('987987987',10,35.0)
INSERT INTO PHANCONG VALUES('987987987',30,5.0)
INSERT INTO PHANCONG VALUES('987654321',30,20.0)
INSERT INTO PHANCONG VALUES('987654321',20,15.0)
INSERT INTO PHANCONG VALUES('888665555',20,NULL)

INSERT INTO THANNHAN VALUES('333445555','The','Nam','10/25/1983','Con trai')
INSERT INTO THANNHAN VALUES('333445555','Loi','Nu','05/03/1958','Vo')
INSERT INTO THANNHAN VALUES('987654321','An','Nam','02/28/1942','Chong')
INSERT INTO THANNHAN VALUES('123456789','Minh','Nam','01/04/1988','Con trai')
INSERT INTO THANNHAN VALUES('123456789','Anh','Nu','12/30/1988','Con gai')
INSERT INTO THANNHAN VALUES('123456789','Yen','Nu','05/05/1967','Vo')

UPDATE PHONGBAN
SET TrPhong = '333445555' WHERE MaPB = 5
UPDATE PHONGBAN
SET TrPhong = '987654321' WHERE MaPB = 4
UPDATE PHONGBAN
SET TrPhong = '888665555' WHERE MaPB = 1

UPDATE PHONGBAN
SET NgNhanChuc = '06/25/1989' WHERE MaPB = 5

